<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pokémon Trainer Registration</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Roboto:wght@400;700&display=swap');

        :root {
            --primary-color: #EE1515;
            --secondary-color: #222224;
            --accent-color: #3B4CCA;
            --bg-color: #FAFAFA;
        }

        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            font-family: 'Roboto', sans-serif;
            background-color: var(--bg-color);
            color: var(--secondary-color);
            overflow: hidden;
        }

        .container {
            display: flex;
            height: 100%;
        }

        .pokeball-section {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            overflow: hidden;
            background-color: #F0F0F0;
        }

        .pokeball {
            width: 300px;
            height: 300px;
            background: linear-gradient(to bottom, var(--primary-color) 0%, var(--primary-color) 48%, #000 48%, #000 52%, #fff 52%, #fff 100%);
            border-radius: 50%;
            position: relative;
            box-shadow: 0 0 0 15px #333;
            animation: shake 1.25s cubic-bezier(.36,.07,.19,.97) infinite;
        }

        .pokeball::before {
            content: '';
            position: absolute;
            background: #fff;
            width: 80px;
            height: 80px;
            border-radius: 50%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            box-shadow: 0 0 0 15px #333;
            z-index: 10;
        }

        .pokeball::after {
            content: '';
            position: absolute;
            background: #fff;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            box-shadow: 0 0 0 10px #333;
            z-index: 11;
        }

        @keyframes shake {
            0% { transform: translate(0, 0) rotate(0); }
            20% { transform: translate(-10px, 0) rotate(-20deg); }
            30% { transform: translate(10px, 0) rotate(20deg); }
            50% { transform: translate(-10px, 0) rotate(-10deg); }
            60% { transform: translate(10px, 0) rotate(10deg); }
            100% { transform: translate(0, 0) rotate(0); }
        }

        .form-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
            background-color: var(--accent-color);
        }

        h1 {
            font-family: 'Press Start 2P', cursive;
            font-size: 24px;
            margin-bottom: 30px;
            text-align: center;
            color: #FFD700;
            text-shadow: 2px 2px 0px #000000;
        }

        form {
            width: 80%;
            
            background-color: #FFFFFF;
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0,0,0,0.2);
        }

        .input-group {
            margin-bottom: 20px;
            position: relative;
        }

        input {
            width: 100%;
            padding: 10px;
            border: 2px solid var(--accent-color);
            border-radius: 5px;
            font-size: 16px;
            color: var(--secondary-color);
        }

        input:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        label {
            position: absolute;
            left: 10px;
            top: 10px;
            transition: 0.3s ease all;
            pointer-events: none;
            color: #666;
            font-size: 14px;
        }

        input:focus ~ label, input:valid ~ label {
            top: -20px;
            font-size: 12px;
            color: var(--primary-color);
        }

        button {
            width: 100%;
            padding: 15px;
            background-color: var(--primary-color);
            border: none;
            border-radius: 5px;
            color: #fff;
            font-family: 'Press Start 2P', cursive;
            font-size: 16px;
            cursor: pointer;
            transition: 0.3s ease all;
            text-transform: uppercase;
        }

        button:hover {
            background-color: #CC0000;
            box-shadow: 0 0 20px rgba(238, 21, 21, 0.5);
        }

        .particles {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        .particle {
            position: absolute;
            background-color: #FFD700;
            border-radius: 50%;
            opacity: 0.6;
        }

        @media (max-width: 768px) {
            .container {
                flex-direction: column;
            }
            .pokeball-section, .form-section {
                flex: none;
            }
            .pokeball {
                width: 200px;
                height: 200px;
            }
            h1 {
                font-size: 20px;
            }
        }
        .starter-selection {
            display: flex;
            justify-content: space-around;
            margin-bottom: 20px;
        }

        .starter-option {
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .starter-option:hover {
            transform: scale(1.1);
        }

        .starter-option img {
            width: 80px;
            height: 80px;
        }

        .selected {
            border: 3px solid var(--primary-color);
            border-radius: 50%;
        }

        #region-select {
            width: 100%;
            padding: 10px;
            border: 2px solid var(--accent-color);
            border-radius: 5px;
            font-size: 16px;
            color: var(--secondary-color);
            background-color: white;
        }

        .error-message {
            color: var(--primary-color);
            font-size: 12px;
            margin-top: 5px;
        }
        .theme-kanto { --primary-color: #FF1111; --bg-color: #FFEEDD; --accent-color:  #FF1111 }
.theme-johto { --primary-color: #39BD39; --bg-color: #EEFFEE; --accent-color:#39BD39 }
.theme-hoenn { --primary-color: #3939BD; --bg-color: #DDEEFF;--accent-color: #3939BD }
.theme-sinnoh { --primary-color: #BDBD39; --bg-color: #FFFFEE;--accent-color: #BDBD39 }
.theme-unova { --primary-color: #BD3939; --bg-color: #FFEEFF; --accent-color:#BD3939 }
.gym-badges {
  display: flex;
  justify-content: space-between;
  margin-bottom: 20px;
}

.badge {
  width: 30px;
  height: 30px;
  border-radius: 50%;
  background-color: #ccc;
  transition: all 0.3s;
}

.badge.earned {
  background-color: gold;
  box-shadow: 0 0 10px gold;
}
.starter-selection {
    display: flex;
    justify-content: space-around;
    margin-bottom: 20px;
}

.starter-option {
    cursor: pointer;
    transition: transform 0.3s ease;
    border: 3px solid transparent;
    border-radius: 50%;
    overflow: hidden;
}

.starter-option:hover {
    transform: scale(1.1);
}

.starter-option img {
    width: 80px;
    height: 80px;
}

.starter-option.selected {
    border-color: var(--primary-color);
}
        
    </style>
</head>
<body>
    <div class="container">
        <div class="pokeball-section">
            <div class="pokeball"></div>
        </div>
        <div class="form-section">
            <h1>Become a Pokémon Trainer!</h1>
            <div class="gym-badges">
                <div class="badge" data-for="name"></div>
                <div class="badge" data-for="email"></div>
                <div class="badge" data-for="starter"></div>
                <div class="badge" data-for="password"></div>
            </div>
            <form id="trainer-form">
                <div class="input-group">
                    <input type="text" id="name" required>
                    <label for="name">Trainer Name</label>
                    <div class="error-message" id="name-error"></div>
                </div>

                <div class="input-group">
                    <input type="email" id="email" required>
                    <label for="email">Trainer Email</label>
                    <div class="error-message" id="email-error"></div>
                </div>
                <div class="input-group">
                    <label for="region-select">Choose your home region</label>
                    <br><br>
                    <select id="region-select" required>
                        <option value="">Select your home region</option>
                        <option value="Kanto">Kanto</option>
                        <option value="Johto">Johto</option>
                        <option value="Hoenn">Hoenn</option>
                        <option value="Sinnoh">Sinnoh</option>
                        <option value="Unova">Unova</option>
                    </select>
                    <div class="error-message" id="region-error"></div>
                </div>
                <div class="input-group">
                    <label>Choose your Starter Pokémon</label>
                    <br><br>
                    <div id="starter-selection" class="starter-selection">
                        <!-- Starter Pokémon will be dynamically inserted here -->
                    </div>
                    <input type="hidden" id="starter" required>
                    <div class="error-message" id="starter-error"></div>
                </div>
               
                <div class="input-group">
                    <input type="password" id="password" required>
                    <label for="password">Pokéword</label>
                    <div class="error-message" id="password-error"></div>
                </div>
                <button type="submit">I Choose You!</button>
            </form>
        </div>
    </div>
    <div class="particles"></div>
    
    <script>
    const regionStarters = {
        "Kanto": [
            { name: "Bulbasaur", image: "https://assets.pokemon.com/assets/cms2/img/pokedex/full/001.png" },
            { name: "Charmander", image: "https://assets.pokemon.com/assets/cms2/img/pokedex/full/004.png" },
            { name: "Squirtle", image: "https://assets.pokemon.com/assets/cms2/img/pokedex/full/007.png" }
        ],
        "Johto": [
            { name: "Chikorita", image: "https://assets.pokemon.com/assets/cms2/img/pokedex/full/152.png" },
            { name: "Cyndaquil", image: "https://assets.pokemon.com/assets/cms2/img/pokedex/full/155.png" },
            { name: "Totodile", image: "https://assets.pokemon.com/assets/cms2/img/pokedex/full/158.png" }
        ],
        "Hoenn": [
            { name: "Treecko", image: "https://assets.pokemon.com/assets/cms2/img/pokedex/full/252.png" },
            { name: "Torchic", image: "https://assets.pokemon.com/assets/cms2/img/pokedex/full/255.png" },
            { name: "Mudkip", image: "https://assets.pokemon.com/assets/cms2/img/pokedex/full/258.png" }
        ],
        "Sinnoh": [
            { name: "Turtwig", image: "https://assets.pokemon.com/assets/cms2/img/pokedex/full/387.png" },
            { name: "Chimchar", image: "https://assets.pokemon.com/assets/cms2/img/pokedex/full/390.png" },
            { name: "Piplup", image: "https://assets.pokemon.com/assets/cms2/img/pokedex/full/393.png" }
        ],
        "Unova": [
            { name: "Snivy", image: "https://assets.pokemon.com/assets/cms2/img/pokedex/full/495.png" },
            { name: "Tepig", image: "https://assets.pokemon.com/assets/cms2/img/pokedex/full/498.png" },
            { name: "Oshawott", image: "https://assets.pokemon.com/assets/cms2/img/pokedex/full/501.png" }
        ]
    };

    const regionSelect = document.getElementById('region-select');
    const starterSelection = document.getElementById('starter-selection');
    const starterInput = document.getElementById('starter');
    const form = document.getElementById('trainer-form');

    function updateStarterPokemon(region) {
        starterSelection.innerHTML = '';
        starterInput.value = '';

        if (region in regionStarters) {
            regionStarters[region].forEach(starter => {
                const starterOption = document.createElement('div');
                starterOption.className = 'starter-option';
                starterOption.dataset.pokemon = starter.name;
                starterOption.innerHTML = `<img src="${starter.image}" alt="${starter.name}">`;
                starterOption.addEventListener('click', selectStarter);
                starterSelection.appendChild(starterOption);
            });
        }

        localStorage.setItem('selectedRegion', region);
    }

    function selectStarter(event) {
        const selectedStarter = event.currentTarget;
        document.querySelectorAll('.starter-option').forEach(option => option.classList.remove('selected'));
        selectedStarter.classList.add('selected');
        starterInput.value = selectedStarter.dataset.pokemon;

        localStorage.setItem('selectedStarter', starterInput.value);

        const pokemonName = selectedStarter.dataset.pokemon.toLowerCase();
        const audioElement = document.getElementById(`${pokemonName}-cry`);
        if (audioElement) {
            audioElement.play();
        }

        updateGymBadges();
    }

    regionSelect.addEventListener('change', (e) => {
        const selectedRegion = e.target.value;
        updateStarterPokemon(selectedRegion);
        document.body.className = `theme-${selectedRegion.toLowerCase()}`;
        updateGymBadges();
        saveFormData();
    });

    function isUserExists(name, email) {
    const users = JSON.parse(localStorage.getItem('users') || '[]');
    return users.some(user => user.name.toLowerCase() === name.toLowerCase() || user.email.toLowerCase() === email.toLowerCase());
}

form.addEventListener('submit', (e) => {
    e.preventDefault();
    console.log('Form submitted');
    if (validateForm()) {
        console.log('Form is valid');
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;
        const name = document.getElementById('name').value;
        const region = document.getElementById('region-select').value;
        const starter = starterInput.value;

        if (isUserExists(name, email)) {
            alert('A user with this username or email already exists. Please choose a different username or email.');
            return;
        }

        const users = JSON.parse(localStorage.getItem('users') || '[]');
        const newUser = { 
            email: email,
            password: password,
            name: name,
            region: region,
            starter: starter,
            favorites: []
        };
        users.push(newUser);
        localStorage.setItem('users', JSON.stringify(users));

        console.log('User data saved');
        alert('Welcome, Trainer! Your journey is about to begin!');
        clearForm(); // Clear the form after successful submission
        redirectToPokedex();
    } else {
        console.log('Form validation failed');
    }
});

function validateForm() {
    let isValid = true;
    const fields = [
        { id: 'name', error: 'name-error', message: 'Please enter your Trainer Name' },
        { id: 'email', error: 'email-error', message: 'Please enter a valid email address' },
        { id: 'region-select', error: 'region-error', message: 'Please select your home region' },
        { id: 'password', error: 'password-error', message: 'Password must be at least 6 characters long' }
    ];

    fields.forEach(field => {
        const element = document.getElementById(field.id);
        if (field.id === 'email' && !/^\S+@\S+\.\S+$/.test(element.value)) {
            showError(field.error, field.message);
            isValid = false;
        } else if (field.id === 'password' && element.value.length < 6) {
            showError(field.error, field.message);
            isValid = false;
        } else if (element.value.trim() === '') {
            showError(field.error, field.message);
            isValid = false;
        } else {
            clearError(field.error);
        }
    });

    if (starterInput.value === '') {
        showError('starter-error', 'Please choose your Starter Pokémon');
        isValid = false;
    } else {
        clearError('starter-error');
    }

    // Check for existing users
    const name = document.getElementById('name').value;
    const email = document.getElementById('email').value;
    if (isUserExists(name, email)) {
        showError('name-error', 'This username is already taken');
        showError('email-error', 'This email is already registered');
        isValid = false;
    }

    console.log('Form validation result:', isValid);
    return isValid;
}

    function showError(elementId, message) {
        document.getElementById(elementId).textContent = message;
    }

    function clearError(elementId) {
        document.getElementById(elementId).textContent = '';
    }

    
    function updateGymBadges() {
        const inputs = document.querySelectorAll('input, select');
        inputs.forEach(input => {
            const badge = document.querySelector(`.badge[data-for="${input.id}"]`);
            if (badge) {
                badge.classList.toggle('earned', input.value !== '');
            }
        });

        const starterBadge = document.querySelector('.badge[data-for="starter"]');
        if (starterBadge) {
            starterBadge.classList.toggle('earned', starterInput.value !== '');
        }
    }

    form.addEventListener('change', () => {
    updateGymBadges();
    saveFormData();
});

    function createParticles() {
        const particlesContainer = document.querySelector('.particles');
        const particleCount = 50;

        for (let i = 0; i < particleCount; i++) {
            const particle = document.createElement('div');
            particle.classList.add('particle');
            particle.style.left = `${Math.random() * 100}%`;
            particle.style.top = `${Math.random() * 100}%`;
            particle.style.width = `${Math.random() * 5 + 2}px`;
            particle.style.height = particle.style.width;
            particlesContainer.appendChild(particle);
            animateParticle(particle);
        }
    }

    function animateParticle(particle) {
        particle.animate([
            { transform: 'translate(0, 0) rotate(0deg)' },
            { transform: `translate(${Math.random() * 100 - 50}px, ${Math.random() * 100 - 50}px) rotate(360deg)` }
        ], {
            duration: Math.random() * 3000 + 2000,
            direction: 'alternate',
            iterations: Infinity
        });
    }

    function saveFormData() {
        const formData = {
            name: document.getElementById('name').value,
            email: document.getElementById('email').value,
            region: document.getElementById('region-select').value,
            starter: starterInput.value,
            password: document.getElementById('password').value
        };
        localStorage.setItem('formData', JSON.stringify(formData));
    }

    function loadFormData() {
        const savedData = localStorage.getItem('formData');
        if (savedData) {
            const formData = JSON.parse(savedData);
            document.getElementById('name').value = formData.name;
            document.getElementById('email').value = formData.email;
            document.getElementById('region-select').value = formData.region;
            document.getElementById('password').value = formData.password;
            starterInput.value = formData.starter;

            updateStarterPokemon(formData.region);

            document.querySelectorAll('.starter-option').forEach(option => {
                if (option.dataset.pokemon === formData.starter) {
                    option.classList.add('selected');
                }
            });

            document.body.className = `theme-${formData.region.toLowerCase()}`;
            updateGymBadges();
        }
    }

    function clearForm() {
    document.getElementById('email').value = '';
    document.getElementById('password').value = '';
    document.getElementById('name').value = '';
    document.getElementById('region-select').value = '';
    starterInput.value = '';

    // Clear starter selection
    document.querySelectorAll('.starter-option').forEach(option => {
        option.classList.remove('selected');
    });

    // Reset gym badges
    updateGymBadges();

    // Clear local storage form data
    localStorage.removeItem('formData');

    // Reset the body class to remove any region-specific theme
    document.body.className = '';

    console.log('Form cleared');
}

function redirectToPokedex() {
    console.log('Attempting to redirect to Pokedex page');
    // Save current user info to session storage
    const currentUser = {
        email: document.getElementById('email').value,
        name: document.getElementById('name').value,
        region: document.getElementById('region-select').value,
        starter: starterInput.value
    };
    sessionStorage.setItem('currentUser', JSON.stringify(currentUser));

    // Clear the form before redirecting
    clearForm();

    // Attempt to redirect to the Pokedex page
    try {
        window.location.href = 'pokedex.html';
        
        // Set a timeout to check if the redirection was successful
        setTimeout(() => {
            if (window.location.href.indexOf('pokedex.html') === -1) {
                throw new Error('Redirection failed');
            }
        }, 1000); // Wait for 1 second
    } catch (error) {
        console.error('Redirection failed:', error);
        alert('Unable to redirect to the Pokedex page. Please ensure pokedex.html exists and try again.');
    }
}


    createParticles();
    loadFormData();
    updateGymBadges();

    </script>

</body>
</html>